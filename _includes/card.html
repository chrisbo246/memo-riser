{% assign post = include.post %}

{% assign categories = '' | split: ' ' | push: post.categories | uniq | compact | sort_natural %}
{% assign tags = '' | split: ' ' | push: post.tags | uniq | compact | sort_natural %}

{% assign today = site.time | date: '%s' %}
{% assign date = post.date | date: '%s' %}
{% assign secondsSince = today | minus: date %}
{% assign hoursSince = secondsSince | divided_by: 60 | divided_by: 60 %}
{% assign daysSince = hoursSince | divided_by: 24 %}



{% assign card-classes = 'card' | split: ' ' %}
{% assign card-classes = card-classes | push: 'filter-target' %}

{% if post.tags contains 'featured' or post.weight %}
    {% assign card-classes = 'card-primary text-white' | split: ' ' | concat: card-classes %}
{% endif %}

{% if page.card.text_align %}
    {% capture class %}text-{{ page.card.text_align }}{% endcapture %}
    {% assign card-classes = card-classes | push: class %}
{% endif %}

{% if include.class %}
{% assign card-classes = include.class | split: ' ' | concat: card-classes %}
{% endif %}

{% if categories and categories.size > page.categories.size %}
{% for category in categories %}
{% assign class = 'category-' | append: category %}
{% assign card-classes = card-classes | push: class %}
{% endfor %}
{% else %}
{% assign card-classes = card-classes | push: 'category-other' %}
{% endif %}

{% if page.card.new and daysSince <= page.card.new %}
  {% assign card-classes = card-classes | push: 'new' %}
{% endif %}

{% if post.weight > 0 %}
{% assign card-classes = 'featured bg-warning text-white' | split: ' ' | concat: card-classes %}
{% endif %}

{% assign card-classes = card-classes | uniq | compact %}



{% if page.card.image != false %}
{% assign src = post.image.default.path | default: post.image.default | default: post.image.path | default: post.image %}
{% endif %}
{% if src %}
    {% assign card-img-classes = 'img-fluid lazyload' | split: ' ' %}
    {% if page.card.image_position == 'top' or page.card.image_position == 'bottom' %}
        {% capture class %}card-img-{{ page.card.image_position }}{% endcapture %}
        {% assign card-img-classes = card-img-classes | push: class %}
    {% else %}
        {% assign card-img-classes = card-img-classes | push: 'card-img' %}
    {% endif %}
    {% if include.img-class %}
    {% assign card-img-classes = include.img-class | split: ' ' | concat: card-img-classes %}
    {% endif %}
    {% assign card-img-classes = card-img-classes | uniq | compact %}
{% endif %}



{% assign card-body-classes = '' | split: ' ' %}
{% if src %}
    {% if page.card.image_position == 'overlay' %}
        {% assign card-body-classes = card-body-classes | push: 'card-img-overlay' %}
    {% else %}
        {% assign card-body-classes = card-body-classes | push: 'card-body' %}
    {% endif %}
{% else %}
    {% assign card-body-classes = card-body-classes | push: 'card-body' %}
{% endif %}
{% assign card-body-classes = card-body-classes | uniq | compact %}



{% assign title = post.title | split: ':' | last | strip %}
{% assign subtitle = post.subtitle %}
{% if title == subtitle %}
    {% assign subtitle = nil %}
{% endif %}

{% if page.card.more_button %}
    {% assign more-link-classes = 'btn btn-primary' | split: ' ' %}
    {% assign more-link-text = page.card.more_button %}
{% elsif page.card.more_link %}
    {% assign more-link-classes = 'card-link' | split: ' ' %}
    {% assign more-link-text = page.card.more_link %}
{% endif %}



<div class="{{ card-classes | join: ' ' }} text-center" >

    {% if src %}
    <img class="{{ card-img-classes | join: ' ' }}" data-src="{{ src }}" alt="{{ post.title }}" width="{{ post.image.default.width | default: post.image.width }}" height="{{ post.image.default.height | default: post.image.height }}">
    {% endif %}

    <div class="{{ card-body-classes | join: ' ' }}">

        {% if title %}
        <h4 class="card-title"><a class="card-link" href="{{ post.url | relative_url }}">{{ title | escape }}</a></h4>
        {% endif %}

        {% if subtitle %}
        <h6 class="card-subtitle mb-2 text-muted">{{ subtitle | escape }}</h6>
        {% endif %}

        {% if post.excerpt %}
        <p class="card-text">{{ post.excerpt | escape }}</p>
        {% endif %}

        {% if more-link-text %}
        <a href="{{ post.url | relative_url }}" class="{{ more-link-classes | join: ' ' }}">{{ more-link-text | escape }}</a>
        {% endif %}

    </div>

    {% if page.card.date or page.card.categories or page.card.tags %}
    <div class="card-footer clearfix hidden-sm visible-xs">
        {% if page.card.categories and categories %}<small class="pull-left ml-2">{% include tags.html tags=categories item-class="badge badge-primary" %}</small>{% endif %}
        {% if page.card.tags and tags %}<small class="pull-left ml-2">{% include tags.html tags=tags item-class="badge badge-secondary" %}</small>{% endif %}
        {% if page.card.date %}<small class="text-muted pull-right">{{ post.date | date: "%b %-d, %Y" }}</small>{% endif %}
        {% if page.card.new and daysSince <= page.card.new %}<small class="text-muted pull-right">Modifi√© il y a {{ daysSince }} jours</small>{% endif %}
    </div>
    {% endif %}

</div>
